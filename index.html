<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mooch Runner</title>
    <!-- Google Fonts - Share Tech Mono (for general text) -->
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <!-- Google Fonts - Orbitron (for clock timer) -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN (Still useful for some utility classes, but primary styling is custom) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Base styles (as per your full app) */
        * { box-sizing: border-box; }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }
        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: #000;
            background-image: radial-gradient(#0f0 1px, #000 1px);
            background-size: 20px 20px;
            color: #0f0; /* Default text color to green */
            display: grid;
            grid-template-rows: auto auto 1fr auto;
            grid-template-columns: 200px 1fr;
            grid-template-areas:
                "header header"
                "live-vote-track live-vote-track"
                "nav main"
                "footer footer";
            min-height: 100vh;
        }

        header {
            grid-area: header;
            text-align: center;
            padding: 1rem;
            background: #001100;
            border-bottom: 2px solid #0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            padding-left: 1rem;
            padding-right: 1rem;
        }

        header .header-logo-title-wrap {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-grow: 1;
            min-width: 150px;
        }

        header img {
            height: 70px; /* Adjusted height for better fit */
            filter: drop-shadow(0 0 8px rgba(0,255,0,0.7));
        }
        @keyframes header-glow {
            0%, 100% { text-shadow: 0 0 5px #0f0, 0 0 10px #0f0, 0 0 20px #0f0; }
            50% { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #0f0; }
        }
        header h1 {
            font-size: 2.5rem;
            text-shadow: 0 0 5px #0f0, 0 0 10px #0f0;
            animation: header-glow 2s infinite alternate ease-in-out;
            color: #0f0;
            margin: 0;
            line-height: 1;
        }
        header .header-tagline {
            font-size: 1rem;
            text-shadow: 0 0 3px #0f0;
        }

        /* Header Timer & Phase Display */
        .header-timer-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 3px; /* Smaller gap */
            font-size: 0.75rem; /* Smaller base font */
            white-space: nowrap;
            position: absolute; /* Adjusted positioning */
            left: 1rem; /* Aligned to the left */
            top: 50%;
            transform: translateY(-50%);
        }
        .header-timer-info .timer-box {
            padding: 3px 8px; /* Further reduced padding */
            background: #000;
            border-radius: 6px; /* Smaller border radius */
            box-shadow: 0 0 6px #0f0, 0 0 10px #0f0 inset; /* Smaller shadow */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .header-timer-info .clock {
            display: flex;
            gap: 2px; /* Very small gap */
            align-items: center;
        }
        .header-timer-info .flip-card {
            width: 30px; /* Smallest flip card width */
            height: 40px; /* Smallest flip card height */
            font-size: 1rem; /* Smallest font size */
            line-height: 40px;
            box-shadow: 0 0 3px rgba(0, 255, 0, 0.7), 0 0 5px rgba(255, 255, 255, 0.3); /* Smallest shadow */
        }
        .header-timer-info .clock span {
            font-size: 1.2rem; /* Smallest colon size */
            color: #0f0;
        }
        .header-timer-info p {
            margin: 0;
            font-size: 0.8rem; /* Smallest text size */
            text-shadow: 0 0 3px #0f0;
        }

        /* Profile Icon (top right of header) */
        .profile-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #000;
            border: 2px solid #0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem; /* Reduced font size for 'M' */
            font-weight: bold;
            color: #0f0;
            filter: drop-shadow(0 0 8px rgba(0,255,0,0.7));
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            flex-shrink: 0;
            z-index: 1005;
            position: absolute; /* Adjusted positioning */
            right: 1rem; /* Aligned to the right */
            top: 50%;
            transform: translateY(-50%);
        }
        .profile-icon:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 0 15px #0f0;
        }

        /* Wallet Settings Modal */
        .wallet-settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1006;
            animation: fade-in 0.3s ease-out;
        }
        .wallet-settings-content {
            background: #001100;
            border: 2px solid #0f0;
            border-radius: 15px;
            box-shadow: 0 0 25px #0f0, 0 0 50px #0f0 inset;
            padding: 1.5rem;
            width: 90%;
            max-width: 350px;
            position: relative;
            text-align: center;
            color: #0f0;
            font-family: 'Share Tech Mono', monospace;
        }
        .wallet-settings-content h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px #0f0;
        }
        .wallet-settings-info p {
            margin-bottom: 0.6rem;
            font-size: 1rem;
            color: #0f0;
            text-shadow: 0 0 2px #0f0;
        }
        .wallet-settings-info span {
            color: #fff;
            text-shadow: 0 0 5px #fff;
        }
        .wallet-settings-buttons {
            display: flex;
            flex-direction: column;
            margin-top: 1.5rem;
            gap: 10px;
        }
        .wallet-settings-buttons button {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            text-shadow: 0 0 5px #0f0;
            box-shadow: 0 0 10px #0f0;
            transition: all 0.2s ease-in-out;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
        }
        .wallet-settings-buttons button:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 20px #0f0, inset 0 0 10px #0f0;
        }


        nav {
            grid-area: nav;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            background: #001100;
            padding: 1rem;
            gap: 10px;
            border-right: 2px solid #0f0;
        }
        nav button {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            text-shadow: 0 0 5px #0f0;
            transition: all 0.3s ease-in-out;
            font-family: 'Share Tech Mono', monospace;
        }
        nav button.active-nav {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 20px #0f0, inset 0 0 10px #0f0;
        }
        nav button:hover:not(.active-nav) {
            background: #003300;
            color: #0f0;
            box-shadow: 0 0 15px #0f0, inset 0 0 8px #0f0;
            transform: scale(1.02);
        }

        main {
            grid-area: main;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            overflow-y: auto;
        }

        /* Common section styling */
        .app-section {
            width: 100%;
            max-width: 600px;
            background: rgba(0, 17, 0, 0.7);
            border: 2px solid #0f0;
            border-radius: 10px;
            box-shadow: 0 0 15px #0f0, 0 0 30px #0f0 inset;
            padding: 0.8rem;
            text-align: center;
            backdrop-filter: blur(2px);
        }
        .app-section h2 {
            font-size: 1.6rem;
            margin-bottom: 0.8rem;
            text-shadow: 0 0 8px #0f0, 0 0 15px #0f0;
            color: #0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        /* Clock Timer Styles */
        .timer-box {
            padding: 5px 10px;
            background: #000;
            border: 2px solid #0f0;
            border-radius: 8px;
            box-shadow: 0 0 8px #0f0, 0 0 15px #0f0 inset;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            color: #0f0;
        }
        .clock {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        .flip-unit {
            perspective: 1000px;
            overflow: hidden;
            border-radius: 4px;
        }
        .flip-card {
            position: relative;
            width: 35px;
            height: 45px;
            font-size: 1.2rem;
            line-height: 45px;
            background: #111;
            color: #0f0;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(0, 255, 0, 0.7), 0 0 10px rgba(255, 255, 255, 0.5);
            transform-style: preserve-3d;
            transition: transform 0.6s;
            font-family: 'Orbitron', sans-serif;
        }
        .clock span {
            font-size: 1.5rem;
            text-shadow: 0 0 5px #0f0;
            color: #0f0;
        }
        @keyframes flip {
            0% { transform: rotateX(0deg); }
            50% { transform: rotateX(-90deg); }
            100% { transform: rotateX(0deg); }
        }

        /* Grid for voting memes */
        .voting-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* 2 columns on mobile, more on wider screens */
            gap: 0.8rem;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        .meme-card {
            background: #000;
            border: 2px solid #0f0;
            border-radius: 10px;
            padding: 0.6rem;
            text-align: center;
            box-shadow: 0 0 10px #0f0, 0 0 20px #0f0;
            transition: transform 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }
        .meme-card:hover {
            transform: scale(1.03);
            box-shadow: 0 0 25px #0f0;
        }
        .meme-card img {
            max-width: 100%;
            height: 90px; /* Further reduced fixed height */
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 0.4rem;
            border: 1px solid #0f0;
            box-shadow: 0 0 5px #0f0;
        }
        .meme-card p {
            color: #0f0;
            text-shadow: 0 0 3px #0f0;
            margin-bottom: 0.2rem;
            font-size: 0.75rem; /* Further reduced font size */
        }
        .meme-card p strong {
            color: #fff;
            text-shadow: 0 0 5px #fff;
        }

        .vote-btn {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 6px 12px;
            margin-top: 0.5rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            text-shadow: 0 0 5px #0f0;
            box-shadow: 0 0 10px #0f0;
            transition: all 0.2s ease-in-out;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.8rem;
        }
        .vote-btn:disabled {
            background: #111;
            color: #555;
            border-color: #444;
            cursor: not-allowed;
            box-shadow: none;
            text-shadow: none;
        }
        .vote-btn:hover:not(:disabled) {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 20px #0f0, inset 0 0 10px #0f0;
        }

        /* Form elements */
        .form-group {
            margin-bottom: 0.7rem;
            text-align: left;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.2rem;
            color: #0f0;
            text-shadow: 0 0 3px #0f0;
            font-size: 0.85rem;
        }
        .form-group input[type="text"],
        .form-group input[type="url"],
        .form-group input[type="file"],
        .form-group input[type="number"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.5rem;
            background: #000;
            border: 1px solid #0f0;
            border-radius: 5px;
            color: #0f0;
            font-family: 'Share Tech Mono', monospace;
            text-shadow: 0 0 2px #0f0;
            box-shadow: inset 0 0 5px rgba(0,255,0,0.5);
            transition: all 0.2s ease;
        }
        .form-group input[type="text"]:focus,
        .form-group input[type="url"]:focus,
        .form-group input[type="file"]:focus,
        .form-group input[type="number"]:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #fff;
            box-shadow: inset 0 0 8px rgba(0,255,0,0.8), 0 0 10px rgba(0,255,0,0.8);
        }
        .form-group input[type="file"]::-webkit-file-upload-button {
            background: #003300;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            text-shadow: 0 0 3px #0f0;
            transition: all 0.2s ease;
        }
        .form-group input[type="file"]::-webkit-file-upload-button:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 10px #0f0;
        }
        .file-preview {
            max-width: 90px;
            height: auto;
            border: 1px solid #0f0;
            margin-top: 5px;
            box-shadow: 0 0 5px #0f0;
        }

        /* Modal Styles (for meme detail) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fade-in 0.3s ease-out;
        }
        .modal-content {
            background: #001100;
            border: 2px solid #0f0;
            border-radius: 15px;
            box-shadow: 0 0 25px #0f0, 0 0 50px #0f0 inset;
            padding: 1rem;
            width: 90%;
            max-width: 320px;
            position: relative;
            text-align: center;
            overflow-y: auto;
            max-height: 90vh;
            color: #0f0;
        }
        .modal-content h3 {
            font-size: 1.4rem;
            margin-bottom: 0.6rem;
            text-shadow: 0 0 10px #0f0, 0 0 20px #0f0;
        }
        .modal-content p {
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
            text-shadow: 0 0 2px #0f0;
        }
        .modal-content img {
            max-width: 90%;
            max-height: 120px;
            height: auto;
            margin: 0.6rem auto;
            border: 2px solid #0f0;
            border-radius: 8px;
            box-shadow: 0 0 15px #0f0;
        }
        .modal-close-btn {
            top: 6px;
            right: 6px;
            font-size: 1.5rem;
        }
        .modal-link {
            font-size: 0.85rem;
        }
        .modal-info-value {
            font-size: 0.9rem;
        }

        /* Notifications */
        #notifications-container {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .notification {
            background: rgba(0, 17, 0, 0.9);
            border: 2px solid #0f0;
            border-radius: 6px;
            padding: 8px 12px;
            box-shadow: 0 0 8px #0f0;
            font-size: 0.8rem;
        }

        /* Live Vote Notifications - Permanent track below header */
        #live-vote-track-container {
            grid-area: live-vote-track;
            width: 100%;
            height: 35px;
            background: rgba(0, 17, 0, 0.9);
            border-bottom: 2px solid #0f0;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            padding: 0 8px;
        }
        .live-vote-track-inner {
            display: flex;
            position: absolute;
            left: 0;
            animation: scroll-left 30s linear infinite;
            white-space: nowrap;
            will-change: transform;
        }
        @keyframes scroll-left {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); }
        }
        .live-vote-slide {
            background: #0f0;
            color: #000;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 0 6px rgba(0, 255, 0, 0.7);
            margin-right: 15px;
            flex-shrink: 0;
        }

        /* Mooch'd Animation */
        .mooched-overlay {
            z-index: 1003;
        }
        .mooched-message {
            font-size: 4rem;
        }

        /* "You have Mooch'd a meme" animation */
        .moochd-meme-overlay {
            z-index: 1004;
        }
        .moochd-meme-message {
            font-size: 2.5rem;
        }

        /* Inactive Phase Animated Image */
        .inactive-phase-container {
            height: 250px;
            padding: 0.8rem;
            gap: 0.8rem;
        }
        .bouncing-image {
            width: 80px;
        }
        .inactive-phase-container p {
            font-size: 1.5rem;
        }

        footer {
            grid-area: footer;
            text-align: center;
            padding: 0.4rem;
            font-size: 0.8rem;
            background: #001100;
            border-top: 2px solid #0f0;
            text-shadow: 0 0 3px #0f0;
            color: #0f0;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto 1fr auto;
                grid-template-areas:
                    "header"
                    "live-vote-track"
                    "nav"
                    "main"
                    "footer";
            }
            nav {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                border-right: none;
                border-bottom: 2px solid #0f0;
                padding: 0.5rem;
                gap: 5px;
            }
            nav button {
                flex-grow: 1;
                font-size: 0.75rem;
                padding: 4px 8px;
                min-width: unset;
            }
            main {
                padding: 0.5rem;
                gap: 0.8rem;
            }
            header {
                flex-direction: column; /* Stack header items vertically */
                align-items: center;
                padding: 0.5rem;
            }
            header .header-logo-title-wrap {
                flex-direction: column;
                gap: 5px;
            }
            header h1 {
                font-size: 1.8rem;
            }
            header img {
                height: 35px;
            }
            .header-timer-info {
                position: static; /* Remove absolute positioning on mobile */
                transform: none;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                gap: 8px;
                margin-top: 10px;
                width: 100%;
            }
            .header-timer-info .timer-box {
                padding: 4px 6px;
            }
            .header-timer-info .flip-card {
                width: 25px;
                height: 35px;
                font-size: 0.9rem;
                line-height: 35px;
            }
            .header-timer-info .clock span {
                font-size: 1rem;
            }
            .header-timer-info p {
                font-size: 0.7rem;
            }

            .profile-icon {
                position: static; /* Remove absolute positioning on mobile */
                transform: none;
                margin-top: 10px;
                width: 35px;
                height: 35px;
                font-size: 1.2rem;
            }
            .wallet-settings-content {
                padding: 1rem;
            }
            .wallet-settings-content h3 {
                font-size: 1.5rem;
            }
            .wallet-settings-info p {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div id="root-container"> {/* New root container for the entire React app */}
        {/* React will render the entire application UI here */}
    </div>
    
    <div id="notifications-container"></div>
    <div id="mooched-animation-container"></div>
    <div id="moochd-meme-animation-container"></div>
    <div id="wallet-settings-modal-root"></div> <!-- Root for wallet settings modal -->


    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation in browser (for development only) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        const ReactDOM = window.ReactDOM;

        // --- Helper for formatting timers ---
        const formatTime = (seconds) => {
            if (seconds < 0) seconds = 0;
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        };

        // --- FlipDisplay Component for animated numbers ---
        const FlipDisplay = ({ value }) => {
            const [currentValue, setCurrentValue] = useState(value);
            const cardRef = useRef(null);

            useEffect(() => {
                if (value !== currentValue) {
                    setCurrentValue(value);
                    if (cardRef.current) {
                        cardRef.current.classList.remove('flip');
                        void cardRef.current.offsetWidth; 
                        cardRef.current.classList.add('flip');
                    }
                }
            }, [value, currentValue]);

            return (
                <div className="flip-unit">
                    <div ref={cardRef} className="flip-card">
                        {currentValue}
                    </div>
                </div>
            );
        };

        // --- WalletSettingsModal Component (new standalone modal) ---
        const WalletSettingsModal = ({ account, chainId, onDisconnect, onClose, MOOCH_PRICE_USD, AVAX_PRICE_USD, mockTokenBalance, mockAvaxBalance }) => {
            // Calculate portfolio value based on passed props
            const portfolioValue = (mockTokenBalance * MOOCH_PRICE_USD + mockAvaxBalance * AVAX_PRICE_USD).toFixed(2);

            return ReactDOM.createPortal(
                <div className="wallet-settings-modal">
                    <div className="wallet-settings-content">
                        <h3>Wallet Details</h3>
                        <div className="wallet-settings-info">
                            <p>Connected: <span>{account ? account.substring(0, 6) + '...' + account.substring(account.length - 4) : 'N/A'}</span></p>
                            <p>Chain ID: <span>{chainId} (Avalanche C-Chain)</span></p>
                            <p>Total Portfolio Value: <span className="text-yellow-300">${portfolioValue}</span></p>
                            <p>MOOCH Holdings: <span className="text-green-300">{mockTokenBalance.toFixed(0)} $MOOCH</span></p>
                            <p>AVAX Holdings: <span className="text-green-300">{mockAvaxBalance.toFixed(2)} AVAX</span></p>
                        </div>
                        <div className="wallet-settings-buttons">
                            <button onClick={onDisconnect}>Disconnect</button>
                            <button onClick={onClose}>Back</button>
                        </div>
                    </div>
                </div>,
                document.getElementById('wallet-settings-modal-root')
            );
        };


        const App = () => {
            // UI State
            const [account, setAccount] = useState(null);
            const [chainId, setChainId] = useState(43114);
            const [message, setMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [activeTab, setActiveTab] = useState('home');
            const [showWalletModal, setShowWalletModal] = useState(false);

            // Cycle Timers and Status (mocked for UI display)
            const [currentCycleStatus, setCurrentCycleStatus] = useState("Submission");
            const [timeRemaining, setTimeRemaining] = useState(3600 * 4 + 10);
            const hours = Math.floor(timeRemaining / 3600);
            const minutes = Math.floor((timeRemaining % 3600) / 60);
            const seconds = Math.floor(timeRemaining % 60);

            // Meme Submission State
            const [memeTicker, setMemeTicker] = useState('');
            const [memeName, setMemeName] = useState('');
            const [memeImage, setMemeImage] = useState(null);
            const [memeDescription, setMemeDescription] = useState('');
            const [memeXLink, setMemeXLink] = useState('');
            const [memeImagePreview, setMemeImagePreview] = useState(null);
            const [isSubmittingMeme, setIsSubmittingMeme] = useState(false);
            const MEME_SUBMISSION_COST = 100;

            // Meme specific animations
            const [showMoochdMemeAnimation, setShowMoochdMemeAnimation] = useState(false);

            // Memes for Display/Voting (mocked data)
            const [activeMemes, setActiveMemes] = useState([
                { id: 1, ticker: "AVAX", name: "Decentralized Snowman", ipfsHash: "300x200/00FF00/000000?text=AI-Snowman", xLink: "https://x.com/mocklink1", votes: 120, active: true, views: 500, submissionDate: "2025-06-25", submitter: "0xMockAddrA1B2C3D4" },
                { id: 2, ticker: "ETH", name: "Blockchain Forest", ipfsHash: "300x200/00FF00/000000?text=AI-Forest", xLink: "https://x.com/mocklink2", votes: 85, active: true, views: 300, submissionDate: "2025-06-26", submitter: "0xMockAddrE5F6G7H8" },
                { id: 3, ticker: "SOL", name: "Speedy Gecko", ipfsHash: "300x200/00FF00/000000?text=AI-Gecko", xLink: "https://x.com/mocklink3", votes: 200, active: true, views: 700, submissionDate: "2025-06-24", submitter: "0xMockAddrI9J0K1L2" },
                { id: 4, ticker: "DOGE", name: "Moon Doge", ipfsHash: "300x200/00FF00/000000?text=AI-Doge", xLink: "https://x.com/mocklink4", votes: 95, active: true, views: 450, submissionDate: "2025-06-27", submitter: "0xMockAddrM3N4O5P6" },
                { id: 5, ticker: "ADA", name: "Smart Contract Tree", ipfsHash: "300x200/00FF00/000000?text=AI-Tree", xLink: "https://x.com/mocklink5", votes: 150, active: true, views: 600, submissionDate: "2025-06-23", submitter: "0xMockAddrQ7R8S9T0" },
            ]);
            const [showMemeDetail, setShowMemeDetail] = useState(false);
            const [selectedMeme, setSelectedMeme] = useState(null);
            const [votedMemeId, setVotedMemeId] = useState(null);
            const [showMoochedAnimation, setShowMoochedAnimation] = useState(false);

            // Trending Memes (Mock Data)
            const [trendingMemes, setTrendingMemes] = useState([]);
            useEffect(() => {
                const sortedTrending = [...activeMemes].sort((a, b) => b.votes - a.votes).slice(0, 3);
                setTrendingMemes(sortedTrending);
            }, [activeMemes]);

            // Top Tokens (Mock Data for Home Tab)
            const [topTokens, setTopTokens] = useState([
                { ticker: "BTC", logo: "100x100/FFA500/000000?text=BTC", mc: "1.3T $" },
                { ticker: "ETH", logo: "100x100/808080/FFFFFF?text=ETH", mc: "400B $" },
                { ticker: "SOL", logo: "100x100/00FFFF/000000?text=SOL", mc: "80B $" },
            ]);

            // Last Meme of the Day
            const [lastMemeOfTheDay, setLastMemeOfTheDay] = useState({ 
                id: 101, 
                ticker: "BTC", 
                name: "Cyberpunk Whale", 
                ipfsHash: "400x300/00FF00/000000?text=AI-Winning+Meme", 
                xLink: "https://x.com/mocklastmeme", 
                votes: 750, 
                submitter: "0xMockSubmitterAddressExample01",
                currentMC: "200B $", 
                ath: "70000 $", 
                totalSupply: "21M BTC", 
                moochUsedToVote: "10 $MOOCH" 
            });

            // Mock token balance for off-chain feature (user's personal MOOCH)
            const [mockTokenBalance, setMockTokenBalance] = useState(0); 
            const [isClaimingTokens, setIsClaimingTokens] = useState(false);

            // Mock Notification State
            const [notifications, setNotifications] = useState([]);
            const [liveVoteNotifications, setLiveVoteNotifications] = useState([]);

            // Mock Global Game Statistics
            const [gameStats, setGameStats] = useState({
                totalMemes: 150,
                totalVotes: 5200,
                activeParticipants: 85,
                cyclesCompleted: 12,
            });

            // Mock Activity Feed (for Trending tab)
            const [activityFeed, setActivityFeed] = useState([
                { id: 1, user: "0xUserA...", action: "voted for", memeName: "Decentralized Snowman", timestamp: "2m ago" },
                { id: 2, user: "0xUserB...", action: "submitted", memeName: "Blockchain Forest", timestamp: "1h ago" },
                { id: 3, user: "0xUserC...", action: "voted for", memeName: "Speedy Gecko", timestamp: "3h ago" },
            ]);

            // Earn Section States
            const [mockMoochSpentTotal, setMockMoochSpentTotal] = useState(0);
            const [avaxPoolBalance, setAvaxPoolBalance] = useState(1000); // Pool AVAX, starts at 1000
            const [mockAvaxBalance, setMockAvaxBalance] = useState(0); // User's personal AVAX balance, starts at 0
            const [userPoints, setUserPoints] = useState(0); // Calculated based on mooch spent
            const [mockApr, setMockApr] = useState(0); // Weekly APR in percentage
            const [userClaimableAvax, setUserClaimableAvax] = useState(0);
            const [isClaimingAvax, setIsClaimingAvax] = useState(false);

            // OTC Section States
            const [swapAvaxAmount, setSwapAvaxAmount] = useState(0);
            const [selectedSwapToken, setSelectedSwapToken] = useState('');
            const launchedTokens = [{ ticker: "$MOOCH", priceRatio: 1 }, { ticker: "TOKENB", priceRatio: 0.5 }]; // Mock launched tokens

            // Mock Prices (Declared once globally in App component)
            const MOOCH_PRICE_USD = 0.05;
            const AVAX_PRICE_USD = 30;

            // --- Notification Functions ---
            const addNotification = useCallback((msg, type = 'info') => {
                const newNotification = { id: Date.now(), message: msg, type: type };
                setNotifications(prev => [newNotification, ...prev].slice(0, 5));
                setTimeout(() => { setNotifications(prev => prev.filter(n => n.id !== newNotification.id)); }, 5000);
            }, []);

            const addLiveVoteNotification = useCallback((msg) => {
                const newNotification = { id: Date.now(), message: msg };
                setLiveVoteNotifications(prev => [...prev, newNotification]);
            }, []);
            
            // --- Live Vote Track Effect ---
            useEffect(() => {
                const track = document.getElementById('live-vote-track-inner');
                if (track) {
                    track.innerHTML = '';
                    liveVoteNotifications.forEach(notification => {
                        const slide = document.createElement('div');
                        slide.className = 'live-vote-slide';
                        slide.textContent = notification.message;
                        track.appendChild(slide);
                    });
                    track.style.animation = 'none';
                    void track.offsetWidth;
                    track.style.animation = null;
                }
            }, [liveVoteNotifications]);


            // Initial load effects
            useEffect(() => {
                addNotification("Welcome to Mooch Runner!", "success");
                addNotification("Connect your wallet to begin!", "info");
            }, [addNotification]);

            // Mock functions for UI interactions
            const connectWallet = () => {
                setIsLoading(true);
                setTimeout(() => {
                    setAccount("0xMockAccount1234567890abcdefABCDEF");
                    addNotification("Mock Wallet Connected!", "success");
                    setMessage("");
                    setIsLoading(false);
                    setShowWalletModal(false);
                }, 1000);
            };

            const disconnectWallet = () => {
                setIsLoading(true);
                setTimeout(() => {
                    setAccount(null);
                    setMessage("Wallet disconnected (mock).");
                    addNotification("Mock Wallet Disconnected!", "warning");
                    setIsLoading(false);
                    setActiveTab('home');
                    setShowWalletModal(false);
                }, 1000);
            };

            // Timer countdown effect
            useEffect(() => {
                const timer = setInterval(() => {
                    setTimeRemaining(prev => {
                        if (prev > 0) return prev - 1;
                        if ((currentCycleStatus === "Voting" || currentCycleStatus === "Prep") && !isLoading) {
                            setTimeout(() => handleEndCycle(), 1000);
                        }
                        return 0;
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, [timeRemaining, currentCycleStatus, isLoading]);

            // --- IPFS Upload Handling (UI only) ---
            const handleImageChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) {
                        addNotification("Image size too large (max 2MB).", "error");
                        setMemeImage(null);
                        setMemeImagePreview(null);
                        return;
                    }
                    setMemeImage(file);
                    setMemeImagePreview(URL.createObjectURL(file));
                } else {
                    setMemeImage(null);
                    setMemeImagePreview(null);
                }
            };

            const uploadToIPFS = async (file) => {
                addNotification("Uploading image to IPFS (mock)...", "info");
                return new Promise(resolve => {
                    setTimeout(() => {
                        const mockText = encodeURIComponent(memeName.substring(0, 10) || 'Meme Upload');
                        const mockHash = `300x200/00FF00/000000?text=${mockText}`;
                        addNotification("Image uploaded to IPFS (mock)!", "success");
                        resolve(mockHash);
                    }, 1500);
                });
            };

            const approveMooch = () => {
                setIsLoading(true);
                setMessage("Simulating $MOOCH token approval...");
                addNotification("Simulating $MOOCH approval...", "info");
                setTimeout(() => {
                    setMessage("Mock: $MOOCH token approval assumed.");
                    addNotification("Mock Approval Confirmed!", "success");
                    setIsLoading(false);
                }, 1500);
            };

            const handleSubmitMeme = async (e) => {
                e.preventDefault();
                if (!isMemeSubmissionOpen()) {
                    addNotification("Meme submission is currently closed.", "error");
                    return;
                }
                if (!memeImage || memeTicker.trim() === '' || memeName.trim() === '') {
                    addNotification("Submission failed: Missing required fields or image.", "error");
                    return;
                }
                if (mockTokenBalance < MEME_SUBMISSION_COST) {
                    addNotification(`Not enough $MOOCH! Submission costs ${MEME_SUBMISSION_COST} $MOOCH. You have ${mockTokenBalance}.`, "error");
                    return;
                }

                setIsSubmittingMeme(true);
                addNotification("Meme submission in progress...", "info");
                
                const ipfsHash = await uploadToIPFS(memeImage); 
                setTimeout(() => {
                    addNotification("Meme submitted successfully!", "success");
                    setShowMoochdMemeAnimation(true);
                    setTimeout(() => setShowMoochdMemeAnimation(false), 3500);

                    const newMeme = {
                        id: activeMemes.length > 0 ? Math.max(...activeMemes.map(m => m.id)) + 1 : 1, 
                        ticker: memeTicker.toUpperCase(),
                        name: memeName,
                        ipfsHash: ipfsHash, 
                        xLink: memeXLink,
                        votes: 0,
                        active: true,
                        views: 0, 
                        submissionDate: new Date().toISOString().slice(0, 10),
                        submitter: account, 
                        moochUsedToVote: `${MEME_SUBMISSION_COST} $MOOCH`,
                        description: memeDescription
                    };
                    setActiveMemes(prevMemes => [...prevMemes, newMeme]); 
                    setGameStats(prev => ({...prev, totalMemes: prev.totalMemes + 1})); 
                    setMockTokenBalance(prev => prev - MEME_SUBMISSION_COST); 
                    setMemeTicker('');
                    setMemeName('');
                    setMemeImage(null);
                    setMemeImagePreview(null);
                    setMemeXLink('');
                    setMemeDescription('');
                    setIsSubmittingMeme(false);
                    setMessage("");
                }, 2000);
            };

            const handleVoteForMeme = (memeId, numVotes = 1) => {
                if (!isVotingOpen) {
                    addNotification("Meme voting is currently closed.", "error");
                    return;
                }
                if (numVotes <= 0 || isNaN(numVotes)) {
                    addNotification("Please enter a valid number of votes (at least 1).", "error");
                    return;
                }
                if (mockTokenBalance < numVotes) {
                    addNotification(`Not enough $MOOCH! You need ${numVotes} $MOOCH but have ${mockTokenBalance}.`, "error");
                    return;
                }

                setIsLoading(true);
                addNotification(`Casting ${numVotes} votes for meme #${memeId}...`, "info");
                setVotedMemeId(memeId); 

                setTimeout(() => {
                    addNotification(`Successfully cast ${numVotes} votes for meme #${memeId}!`, "success");
                    addLiveVoteNotification(`${numVotes} votes for "${activeMemes.find(m => m.id === memeId)?.name}"`);
                    setActiveMemes(prevMemes => 
                        prevMemes.map(meme => 
                            meme.id === memeId ? { ...meme, votes: meme.votes + numVotes } : meme
                        )
                    );
                    setMockTokenBalance(prev => prev - numVotes);
                    setGameStats(prev => ({...prev, totalVotes: prev.totalVotes + numVotes}));

                    setVoteHistory(prev => [
                        { id: Date.now(), memeId, memeName: activeMemes.find(m => m.id === memeId)?.name, votes: numVotes, moochSpent: numVotes, timestamp: new Date().toLocaleString() },
                        ...prev
                    ]);

                    setShowMoochedAnimation(true);
                    setTimeout(() => setShowMoochedAnimation(false), 3500);

                    const votedMeme = activeMemes.find(m => m.id === memeId);
                    if (votedMeme) {
                        setActivityFeed(prev => [
                            { id: Date.now(), user: account, action: `voted ${numVotes}x for`, memeName: votedMeme.name, timestamp: "just now" },
                            ...prev
                        ].slice(0, 10));
                    }

                    setIsLoading(false);
                    setVotedMemeId(null); 
                    setMessage(""); 
                }, 1000);
            };

            const handleEndCycle = () => {
                if (!isEndCyclePossible && timeRemaining > 0) {
                     addNotification("Cycle cannot be ended yet. Wait for Prep phase to conclude.", "warning");
                     return;
                }
                setIsLoading(true);
                addNotification("Attempting to end cycle...", "info");
                setCurrentCycleStatus("Processing...");
                setTimeout(() => {
                    addNotification("Cycle ended! New winner announced and new cycle started.", "success");
                    setCurrentCycleStatus("Submission");
                    setTimeRemaining(3600 * 24);
                    
                    const winner = [...activeMemes].sort((a,b) => b.votes - a.votes)[0];
                    if (winner) {
                        setLastMemeOfTheDay({
                            ...winner,
                            ipfsHash: winner.ipfsHash.replace('200x150', '400x300'),
                            votes: winner.votes,
                            submitter: winner.submitter,
                            currentMC: (Math.random() * 50 + 10).toFixed(1) + "B $",
                            ath: (Math.random() * 10000 + 100).toFixed(0) + " $",
                            totalSupply: (Math.random() * 1000).toFixed(0) + "T tokens",
                            moochUsedToVote: "1 $MOOCH"
                        });
                        setActiveMemes([]);
                        setTrendingMemes([]);
                    } else {
                        setLastMemeOfTheDay(null);
                        setActiveMemes([]);
                        setTrendingMemes([]);
                    }
                    setGameStats(prev => ({...prev, cyclesCompleted: prev.cyclesCompleted + 1}));
                    setIsLoading(false);
                    setMessage("");
                }, 3000);
            };

            const handleClaimTestnetTokens = () => {
                setIsClaimingTokens(true);
                addNotification("Claiming tokens...", "info");
                setTimeout(() => {
                    setMockTokenBalance(prev => prev + 1000);
                    addNotification("1000 $MOOCH tokens claimed!", "success");
                    setIsClaimingTokens(false);
                }, 1500);
            };

            // Phase change for testing
            const togglePhase = () => {
                if (currentCycleStatus === "Submission") {
                    setCurrentCycleStatus("Voting");
                    setTimeRemaining(3600 * 2 + 10);
                    addNotification("Phase changed to Voting!", "info");
                } else if (currentCycleStatus === "Voting") {
                    setCurrentCycleStatus("Prep");
                    setTimeRemaining(10);
                    addNotification("Phase changed to Prep!", "info");
                } else {
                    setCurrentCycleStatus("Submission");
                    setTimeRemaining(3600 * 4 + 10);
                    addNotification("Phase changed to Submission!", "info");
                }
            };


            // Determine if an action is available based on current phase (mocked)
            const isMemeSubmissionOpen = currentCycleStatus === "Submission" && timeRemaining > 0;
            const isVotingOpen = currentCycleStatus === "Voting" && timeRemaining > 0;
            const isPrepPhase = currentCycleStatus === "Prep"; 
            const isEndCyclePossible = currentCycleStatus === "Prep" && timeRemaining <= 0; 

            // State for vote history
            const [voteHistory, setVoteHistory] = useState([]);
            
            // Calculate user points and claimable AVAX
            useEffect(() => {
                setUserPoints(mockMoochSpentTotal); // 1 point per MOOCH spent
                const calculatedApr = (mockMoochSpentTotal / 500) * 0.2; // Example: 0.2% APR per 500 MOOCH spent
                setMockApr(calculatedApr * 100); // Convert to percentage
                const claimable = (mockMoochSpentTotal / 100) * AVAX_PRICE_USD; // Example: 1 AVAX per 100 points
                setUserClaimableAvax(claimable);

            }, [mockMoochSpentTotal]);

            // Update total MOOCH spent when voting or submitting
            useEffect(() => {
                const totalSpentFromHistory = voteHistory.reduce((sum, record) => sum + record.moochSpent, 0);
                setMockMoochSpentTotal(totalSpentFromHistory);
            }, [voteHistory]);


            const handleClaimAvax = () => {
                setIsClaimingAvax(true);
                addNotification(`Attempting to claim ${userClaimableAvax.toFixed(2)} AVAX...`, "info");
                setTimeout(() => {
                    if (userClaimableAvax > 0) {
                        setMockAvaxBalance(prev => prev + userClaimableAvax);
                        setAvaxPoolBalance(prev => Math.max(0, prev - userClaimableAvax)); // Deduct from pool
                        addNotification(`Successfully claimed ${userClaimableAvax.toFixed(2)} AVAX!`, "success");
                        setUserClaimableAvax(0);
                        setUserPoints(0);
                    } else {
                        addNotification("No AVAX to claim.", "warning");
                    }
                    setIsClaimingAvax(false);
                }, 2000);
            };

            const handleSwapAvaxToToken = () => {
                if (swapAvaxAmount <= 0 || !selectedSwapToken) {
                    addNotification("Please enter a valid amount and select a token to swap.", "error");
                    return;
                }
                if (mockAvaxBalance < swapAvaxAmount) {
                    addNotification("Not enough AVAX for this swap.", "error");
                    return;
                }
                const tokenPriceRatio = launchedTokens.find(t => t.ticker === selectedSwapToken)?.priceRatio || 1;
                const receivedTokens = (swapAvaxAmount * (AVAX_PRICE_USD / MOOCH_PRICE_USD)) * tokenPriceRatio * 1.1; // 10% discount
                
                addNotification(`Swapping ${swapAvaxAmount} AVAX for ${receivedTokens.toFixed(2)} ${selectedSwapToken}...`, "info");
                setIsLoading(true);

                // Mock transaction details
                const gasFee = (Math.random() * 0.01).toFixed(4); // Mock gas fee
                const slippage = (Math.random() * 0.5 + 0.1).toFixed(2); // Mock slippage 0.1-0.6%
                const mockTxHash = `0x${Math.random().toString(16).substr(2, 64)}`; // Mock transaction hash
                const mockExplorerUrl = `https://avascan.info/tx/${mockTxHash}`; // Mock explorer link

                setTimeout(() => {
                    setMockAvaxBalance(prev => prev - swapAvaxAmount);
                    if (selectedSwapToken === "$MOOCH") {
                        setMockTokenBalance(prev => prev + Math.floor(receivedTokens));
                    }
                    addNotification(`Swap successful! Received ${receivedTokens.toFixed(2)} ${selectedSwapToken}.`, "success");
                    addNotification(`Tx: ${mockTxHash.substring(0, 8)}... | Gas: ${gasFee} AVAX | Slippage: ${slippage}% <a href="${mockExplorerUrl}" target="_blank" class="modal-link">View Tx</a>`, "info");

                    setSwapAvaxAmount(0);
                    setSelectedSwapToken('');
                    setIsLoading(false);
                }, 2000);
            };


            // --- Bouncing Image Animation Logic (for inactive phases) ---
            const bouncingImageRef = useRef(null);
            const animationContainerRef = useRef(null);

            useEffect(() => {
                const img = bouncingImageRef.current;
                const container = animationContainerRef.current;
                if (!img || !container) return;

                let posX = 0;
                let posY = 0;
                let directionX = 1;
                let directionY = 1;
                const speed = 2;

                img.style.transform = `translate(0px, 0px)`;

                const animate = () => {
                    if (!img || !container || (isMemeSubmissionOpen || isVotingOpen)) {
                        return;
                    }

                    const containerWidth = container.clientWidth;
                    const containerHeight = container.clientHeight;
                    const imgWidth = img.offsetWidth;
                    const imgHeight = img.offsetHeight;

                    posX += directionX * speed;
                    posY += directionY * speed;

                    if (posX + imgWidth > containerWidth) {
                        directionX = -1;
                        posX = containerWidth - imgWidth;
                    } else if (posX < 0) {
                        directionX = 1;
                        posX = 0;
                    }

                    if (posY + imgHeight > containerHeight) {
                        directionY = -1;
                        posY = containerHeight - imgHeight;
                    } else if (posY < 0) {
                        directionY = 1;
                        posY = 0;
                    }

                    img.style.transform = `translate(${posX}px, ${posY}px)`;
                    requestAnimationFrame(animate);
                };

                if (!isMemeSubmissionOpen && !isVotingOpen) {
                    animate();
                }

            }, [isMemeSubmissionOpen, isVotingOpen]);


            // Conditional rendering for active sections
            const renderContent = () => {
                switch (activeTab) {
                    case 'home':
                        return (
                            <>
                                <p className="text-xl font-bold text-green-300 text-shadow-[0_0_5px_rgba(0,255,0,0.7)] mb-4">When accident launch happens, we mooch.</p>

                                {/* Last Meme of the Day Gallery */}
                                <div className="app-section">
                                    <h2>🏆 Last Meme of the Day</h2>
                                    {lastMemeOfTheDay ? (
                                        <div className="text-center">
                                            <p className="text-lg font-bold text-green-300">{lastMemeOfTheDay.name}</p>
                                            <p className="text-sm">Ticker: {lastMemeOfTheDay.ticker}</p>
                                            <img
                                                src={`https://placehold.co/${lastMemeOfTheDay.ipfsHash}`} 
                                                alt={lastMemeOfTheDay.name}
                                                className="mt-4 mx-auto max-h-64 rounded-lg border border-green-700 animate-pulse-light cursor-pointer"
                                                onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/150x150/003300/00FF00?text=Image+Error"; }}
                                                onClick={() => { setSelectedMeme(lastMemeOfTheDay); setShowMemeDetail(true); }}
                                            />
                                            {lastMemeOfTheDay.xLink && (
                                                <a href={lastMemeOfTheDay.xLink} target="_blank" rel="noopener noreferrer" className="modal-link mt-2 inline-block text-lg">
                                                    View on X
                                                </a>
                                            )}
                                        </div>
                                    ) : (
                                        <p className="text-center text-lg text-gray-300">No meme determined yet for the last cycle (mock data).</p>
                                    )}
                                </div>

                                {/* Game Statistics */}
                                <div className="app-section">
                                    <h2>📊 Game Statistics</h2>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-left">
                                        <p><span className="text-white">Total Memes:</span> {gameStats.totalMemes}</p>
                                        <p><span className="text-white">Total Votes:</span> {gameStats.totalVotes}</p>
                                        <p><span className="text-white">Participants:</span> {gameStats.activeParticipants}</p>
                                        <p><span className="text-white">Cycles Done:</span> {gameStats.cyclesCompleted}</p>
                                    </div>
                                </div>

                                {/* Current Top 3 Tokens */}
                                <div className="app-section">
                                    <h2>🔝 Top Tokens</h2>
                                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-6">
                                        {topTokens.map((token, index) => (
                                            <div key={index} className="flex flex-col items-center p-4 bg-black bg-opacity-50 rounded-lg border border-0f0 shadow-md">
                                                <img src={`https://placehold.co/${token.logo}`} alt={`${token.ticker} Logo`} className="w-16 h-16 rounded-full border border-0f0 mb-2 glow-image-thumb" />
                                                <p className="text-xl font-bold">{token.ticker}</p>
                                                <p className="text-sm text-gray-300">MC: {token.mc}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Phase Change Button for Testing */}
                                <div className="app-section">
                                    <button
                                        onClick={togglePhase}
                                        className="vote-btn w-auto px-8 py-3"
                                    >
                                        Toggle Phase (For Testing)
                                    </button>
                                </div>
                            </>
                        );
                    case 'submit':
                        return (
                            <div className="app-section w-full max-w-2xl mx-auto">
                                <h2>⬆️ Submit Your Meme</h2>
                                <p className="text-green-100 mb-6">Unleash your creativity! Submit your most epic meme to compete for votes and glory.</p>
                                { !isMemeSubmissionOpen ? ( /* Check function result */
                                    <div ref={animationContainerRef} className="inactive-phase-container">
                                        <img ref={bouncingImageRef} src="https://imgur.com/zPo1ir5.png" alt="Bouncing Icon" className="bouncing-image" />
                                        <p className="text-2xl font-bold text-red-400 z-20">Submission is CLOSED!</p>
                                        <p className="text-xl text-yellow-300 z-20">Go Vote or Check Trending Memes!</p>
                                    </div>
                                ) : (
                                    <>
                                        <p className="text-green-100 mb-4">Cost to submit: <span className="text-yellow-300 font-bold">{MEME_SUBMISSION_COST} $MOOCH</span></p>
                                        <form onSubmit={handleSubmitMeme} className="space-y-4 text-left">
                                            <div className="form-group">
                                                <label htmlFor="memeTicker">Meme Ticker:</label>
                                                <input
                                                    type="text"
                                                    id="memeTicker"
                                                    value={memeTicker}
                                                    onChange={(e) => setMemeTicker(e.target.value)}
                                                    placeholder="e.g., AVAX, BTC"
                                                    required
                                                    disabled={isSubmittingMeme}
                                                />
                                            </div>
                                            <div className="form-group">
                                                <label htmlFor="memeName">Meme Title:</label>
                                                <input
                                                    type="text"
                                                    id="memeName"
                                                    value={memeName}
                                                    onChange={(e) => setMemeName(e.target.value)}
                                                    placeholder="e.g., Diamond Hands"
                                                    required
                                                    disabled={isSubmittingMeme}
                                                />
                                            </div>
                                            <div className="form-group">
                                                <label htmlFor="memeImage">Meme Image (PNG/JPG, max 2MB):</label>
                                                <input
                                                    type="file"
                                                    id="memeImage"
                                                    accept="image/png, image/jpeg"
                                                    onChange={handleImageChange}
                                                    required
                                                    disabled={isSubmittingMeme}
                                                />
                                                {memeImagePreview && (
                                                    <img src={memeImagePreview} alt="Meme Preview" className="file-preview mx-auto" />
                                                )}
                                            </div>
                                            <div className="form-group">
                                                <label htmlFor="memeDescription">Description (optional):</label>
                                                <textarea
                                                    id="memeDescription"
                                                    value={memeDescription}
                                                    onChange={(e) => setMemeDescription(e.target.value)}
                                                    placeholder="A brief description of your meme..."
                                                    disabled={isSubmittingMeme}
                                                    rows="3"
                                                ></textarea>
                                            </div>
                                            <div className="form-group">
                                                <label htmlFor="memeXLink">Optional X (Twitter) Link:</label>
                                                <input
                                                    type="url"
                                                    id="memeXLink"
                                                    value={memeXLink}
                                                    onChange={(e) => setMemeXLink(e.target.value)}
                                                    placeholder="e.g., https://twitter.com/..."
                                                    disabled={isSubmittingMeme}
                                                />
                                            </div>
                                            <button
                                                type="submit"
                                                disabled={isSubmittingMeme || mockTokenBalance < MEME_SUBMISSION_COST}
                                                className="vote-btn w-full"
                                            >
                                                {isSubmittingMeme ? "Submitting (Mock)..." : `Submit Meme (${MEME_SUBMISSION_COST} $MOOCH)`}
                                            </button>
                                        </form>
                                    </>
                                )}
                            </div>
                        );
                    case 'vote':
                        return (
                            <div className="app-section">
                                <h2>✨ Vote for Memes</h2>
                                {!isVotingOpen ? (
                                    <div ref={animationContainerRef} className="inactive-phase-container">
                                        <img ref={bouncingImageRef} src="https://imgur.com/zPo1ir5.png" alt="Bouncing Icon" className="bouncing-image" />
                                        <p className="text-2xl font-bold text-red-400 z-20">Voting is CLOSED!</p>
                                        <p className="text-xl text-yellow-300 z-20">Go Submit or Check Trending Memes!</p>
                                    </div>
                                ) : (
                                    activeMemes.length > 0 ? (
                                        <div className="voting-grid">
                                            {activeMemes.map((meme, index) => (
                                                <div 
                                                    key={meme.id !== undefined ? meme.id : index} 
                                                    className={`meme-card ${votedMemeId === meme.id ? 'voted-pulse' : ''}`}
                                                >
                                                    <img 
                                                        src={`https://placehold.co/${meme.ipfsHash}`} 
                                                        alt={meme.name} 
                                                        onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/200x150/003300/00FF00?text=Image+Error"; }}
                                                        onClick={() => { setSelectedMeme(meme); setShowMemeDetail(true); }}
                                                    />
                                                    <div>
                                                        <p>{meme.name}</p>
                                                        <p>Ticker: {meme.ticker}</p>
                                                        <p>Votes: <strong id={`votes-${meme.id}`}>{meme.votes.toString()}</strong></p>
                                                        <p>Views: {meme.views.toString()}</p>
                                                        <p>Submitted: {meme.submissionDate}</p>
                                                        {isVotingOpen && (
                                                            <div className="flex flex-col items-center mt-2">
                                                                <label htmlFor={`num-votes-${meme.id}`} className="text-sm mb-1">Votes (<span className="text-white">1 $MOOCH/vote</span>):</label>
                                                                <input 
                                                                    type="number" 
                                                                    id={`num-votes-${meme.id}`} 
                                                                    min="1" 
                                                                    defaultValue="1" 
                                                                    className="w-24 p-1 text-center bg-black border border-0f0 rounded-md text-0f0 font-mono"
                                                                    onClick={e => e.stopPropagation()} /* Prevent modal from opening when clicking input */
                                                                />
                                                                <button
                                                                    onClick={(e) => { 
                                                                        e.stopPropagation(); 
                                                                        const numVotesInput = document.getElementById(`num-votes-${meme.id}`);
                                                                        const numVotes = parseInt(numVotesInput.value, 10);
                                                                        handleVoteForMeme(meme.id, numVotes); 
                                                                    }} 
                                                                    disabled={isLoading || (mockTokenBalance < 1)} /* Disable if no mooch to vote */
                                                                    className="vote-btn"
                                                                >
                                                                    ⬆️ Vote ({parseInt(document.getElementById(`num-votes-${meme.id}`)?.value || 1, 10)} $MOOCH)
                                                                </button>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <p className="text-center text-lg text-gray-300">No memes submitted for this cycle yet (mock data).</p>
                                    )
                                )}
                            </div>
                        );
                    case 'wallet': /* Renamed from 'balance' to 'wallet' */
                        return (
                            <div className="app-section w-full max-w-xl mx-auto">
                                <h2>📊 Your Wallet & Transactions</h2>
                                <p className="text-green-100 mb-4 text-xl">Your Mock $MOOCH Balance: <span className="text-4xl font-bold text-green-300 text-shadow-[0_0_8px_rgba(0,255,0,0.7)]">{mockTokenBalance} $MOOCH</span></p>
                                <p className="text-green-100 text-xl mb-6">Your Mock AVAX Balance: <span className="text-4xl font-bold text-green-300 text-shadow-[0_0_8px_rgba(0,255,0,0.7)]">{mockAvaxBalance.toFixed(2)} AVAX</span></p>

                                <button
                                    onClick={handleClaimTestnetTokens}
                                    disabled={isClaimingTokens}
                                    className="vote-btn w-full mb-4"
                                >
                                    {isClaimingTokens ? "Claiming..." : "Claim 1000 $MOOCH (Off-Chain Mock)"}
                                </button>
                                <button
                                    onClick={approveMooch}
                                    disabled={isLoading}
                                    className="vote-btn w-full"
                                >
                                    {isLoading ? "Processing..." : "Simulate Approval (Mock)"}
                                </button>

                                <h3 className="text-2xl mt-8 mb-4 text-left border-b border-0f0 pb-2">Vote & Submission History</h3>
                                {voteHistory.length > 0 ? (
                                    <div className="text-left max-h-60 overflow-y-auto border border-0f0 p-2 rounded">
                                        {voteHistory.map(record => (
                                            <p key={record.id} className="mb-1 text-sm">
                                                <span className="text-white">{record.timestamp}:</span> Voted <span className="text-0ff">{record.votes}x</span> for <span className="text-green-300">"{record.memeName}"</span> (<span className="text-yellow-300">{record.moochSpent} $MOOCH (~${(record.moochSpent * MOOCH_PRICE_USD).toFixed(2)})</span>)
                                            </p>
                                        ))}
                                    </div>
                                ) : (
                                    <p className="text-gray-300">No transaction history yet.</p>
                                )}

                                <h3 className="text-2xl mt-8 mb-4 text-left border-b border-0f0 pb-2">Your Points</h3>
                                <div className="text-left space-y-3">
                                    <p className="text-green-100">Your Earned Points: <span className="text-white font-bold">{userPoints}</span></p>
                                    <p className="text-green-100">Weekly APR: <span className="text-yellow-300 font-bold">{mockApr.toFixed(2)}%</span> (based on points)</p>
                                </div>
                                
                                {/* Earn Section - Now integrated directly under Wallet */}
                                <h3 className="text-2xl mt-8 mb-4 text-left border-b border-0f0 pb-2">💰 Earn $AVAX</h3>
                                <p className="text-green-100 mb-4">Participate in the ecosystem to earn your share of the AVAX rewards pool!</p>
                                <div className="text-left space-y-3">
                                    <p className="text-green-100">AVAX Pool Balance: <span className="text-white font-bold">{avaxPoolBalance.toFixed(2)} AVAX</span></p>
                                    <p className="text-green-100">Total Community Points: <span className="text-white font-bold">{gameStats.totalVotes + gameStats.totalMemes * MEME_SUBMISSION_COST}</span></p>
                                    <p className="text-green-100">Overall Weekly APR: <span className="text-yellow-300 font-bold">{(gameStats.totalVotes + gameStats.totalMemes * MEME_SUBMISSION_COST > 0 ? ((gameStats.totalVotes + gameStats.totalMemes * MEME_SUBMISSION_COST) / 1000) * 10 : 0).toFixed(2)}%</span></p>
                                    <p className="text-green-100 mt-6">Your Claimable AVAX: <span className="text-yellow-300 font-bold">{userClaimableAvax.toFixed(2)} AVAX</span></p>
                                    <button onClick={handleClaimAvax} disabled={isClaimingAvax || userClaimableAvax <= 0} className="vote-btn w-full">
                                        {isClaimingAvax ? "Claiming AVAX..." : `Claim ${userClaimableAvax.toFixed(2)} AVAX`}
                                    </button>
                                </div>

                                {/* OTC Button - Now integrated directly under Wallet */}
                                <h3 className="text-2xl mt-8 mb-4 text-left border-b border-0f0 pb-2">💱 OTC / Swap</h3>
                                <p className="text-green-100 mb-4">Swap your AVAX for $MOOCH or other launched tokens with a 10% discount!</p>
                                <div className="text-left space-y-3">
                                    <p className="text-green-100">OTC Total Supply: <span className="text-white font-bold">100,000,000 $MOOCH (mock)</span></p>
                                    <p className="text-green-100">Swap Limit: <span className="text-white font-bold">Max 100 AVAX per transaction (mock)</span></p>

                                    <h4 className="text-xl mt-6">Swap AVAX to Token</h4>
                                    <div className="flex flex-col sm:flex-row gap-4 items-center">
                                        <div className="form-group flex-1 w-full">
                                            <label htmlFor="swapAvaxAmount">Amount AVAX:</label>
                                            <input type="number" id="swapAvaxAmount" min="0.1" step="0.1" value={swapAvaxAmount} onChange={(e) => setSwapAvaxAmount(parseFloat(e.target.value) || 0)} className="w-full p-2 bg-black border border-0f0 rounded text-0f0 font-mono" max="100" />
                                        </div>
                                        <div className="form-group flex-1 w-full">
                                            <label htmlFor="swapToken">Select Token:</label>
                                            <select id="swapToken" value={selectedSwapToken} onChange={(e) => setSelectedSwapToken(e.target.value)} className="w-full p-2 bg-black border border-0f0 rounded text-0f0 font-mono">
                                                <option value="">Select Token</option>
                                                {launchedTokens.map(token => (
                                                    <option key={token.ticker} value={token.ticker}>{token.ticker}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    <p className="text-green-100 text-sm italic">Expected Output: <span className="text-white font-bold">{(swapAvaxAmount / AVAX_PRICE_USD / MOOCH_PRICE_USD * 1.1).toFixed(2)} {selectedSwapToken || "$MOOCH"}</span></p>
                                    <p className="text-green-100 text-sm italic">Mock Gas Fee: <span className="text-white font-bold">~0.005 AVAX</span></p>
                                    <p className="text-green-100 text-sm italic">Mock Slippage: <span className="text-white font-bold">0.5%</span></p>
                                    
                                    <button onClick={handleSwapAvaxToToken} disabled={swapAvaxAmount <= 0 || !selectedSwapToken || mockAvaxBalance < swapAvaxAmount || isLoading || swapAvaxAmount > 100} className="vote-btn w-full">
                                        Swap Now
                                    </button>
                                </div>
                            </div>
                        );
                    case 'trending':
                        return (
                            <div className="app-section">
                                <h2>📈 Trending Memes</h2>
                                {trendingMemes.length > 0 ? (
                                    <div className="voting-grid">
                                        {trendingMemes.map((meme, index) => (
                                            <div 
                                                key={meme.id !== undefined ? meme.id : index} 
                                                className="meme-card"
                                                onClick={() => { setSelectedMeme(meme); setShowMemeDetail(true); }}
                                            >
                                                <img 
                                                    src={`https://placehold.co/${meme.ipfsHash}`} 
                                                    alt={meme.name} 
                                                    onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/200x150/003300/00FF00?text=Image+Error"; }}
                                                />
                                                <div>
                                                    <p>{meme.name}</p>
                                                    <p>Ticker: {meme.ticker}</p>
                                                    <p>Votes: <strong>{meme.votes.toString()}</strong></p>
                                                    <p>Views: {meme.views.toString()}</p>
                                                </div>
                                                <button
                                                    onClick={(e) => { e.stopPropagation(); handleVoteForMeme(meme.id); }} 
                                                    disabled={!isVotingOpen || isLoading || (mockTokenBalance < 1)}
                                                    className="vote-btn"
                                                >
                                                    ⬆️ Vote
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <p className="text-center text-lg text-gray-300">No memes currently trending (mock data).</p>
                                )}

                                <h3 className="text-2xl mt-8 mb-4 text-left border-b border-0f0 pb-2">Recent Activity</h3>
                                {activityFeed.length > 0 ? (
                                    <div className="text-left max-h-60 overflow-y-auto border border-0f0 p-2 rounded">
                                        {activityFeed.map(activity => (
                                            <p key={activity.id} className="mb-1 text-sm">
                                                <span className="text-white">{activity.timestamp}:</span> User <span className="text-0ff">{activity.user.substring(0, 8)}...</span> {activity.action} <span className="text-green-300">"{activity.memeName}"</span>
                                            </p>
                                        ))}
                                    </div>
                                ) : (
                                    <p className="text-gray-300">No recent activity.</p>
                                )}
                            </div>
                        );
                    case 'about':
                        return (
                            <div className="app-section w-full max-w-2xl mx-auto">
                                <h2>ℹ️ About Mooch Runner</h2>
                                <p className="text-green-100 mb-4">
                                    Mooch Runner is a decentralized application (dApp) for meme enthusiasts to submit, vote on, and celebrate the best memes! 
                                    This version is a UI demonstration with mock data and functionality.
                                </p>
                                <p className="text-green-100 mb-4">
                                    Participants can submit memes during the submission phase, and then vote for their favorite memes and tokens ($MOOCH) during the voting phase. 
                                    At the end of each cycle, a winning meme is declared!
                                </p>
                                <h3 className="text-2xl mt-6 mb-4 flex items-center justify-center gap-2">
                                    🚀 How It Works
                                </h3>
                                <ul className="text-left list-disc list-inside space-y-2 text-green-100">
                                    <li><strong>1. Connect Wallet:</strong> Join with MetaMask or other EVM wallets</li>
                                    <li><strong>2. Submit Memes:</strong> Upload the funniest memes to compete</li>
                                    <li><strong>3. Vote Daily:</strong> Support your favorite memes and creators</li>
                                    <li><strong>4. Earn $MOOCH:</strong> Top memes win and earn real rewards</li>
                                </ul>

                                <h3 className="text-2xl mt-6 mb-4 flex items-center justify-center gap-2">
                                    🤝 Community
                                </h3>
                                <div className="flex justify-center items-center space-x-6">
                                    <a href="https://x.com/MoochonAvax" target="_blank" rel="noopener noreferrer" className="text-green-300 hover:text-white transition-colors duration-200">
                                        {/* Twitter (X) Logo SVG */}
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-10 h-10 drop-shadow-[0_0_8px_#0f0]">
                                            <path d="M18.244 2.25h3.308l-7.227 8.260 8.017 11.740h-6.765l-6.23-9.110-3.328 9.110h-3.308l7.227-8.260-8.017-11.740h6.765l6.23 9.110zM12 1.5l-8 11.5 8 10.5 8-10.5-8-11.5zM12 2.5l7 10 7-9 7 9-7 10-7-9-7 10zM12 3.5l6 9.5 6-8.5 6 8.5-6 9.5-6-8.5-6 9.5zM12 4.5l5 8.5 5-7.5 5 7.5-5 8.5-5-7.5-5 8.5z"/>
                                            <path d="M18.244 2.25h3.308l-7.227 8.260 8.017 11.740h-6.765l-6.23-9.110-3.328 9.110h-3.308l7.227-8.260-8.017-11.740h6.765l6.23 9.110z" />
                                        </svg>
                                    </a>
                                    <a href="https://t.me/themoochonavax" target="_blank" rel="noopener noreferrer" className="text-green-300 hover:text-white transition-colors duration-200">
                                        {/* Telegram Logo SVG (simplified) */}
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-10 h-10 drop-shadow-[0_0_8px_#0f0]">
                                            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm6.65 8.59l-2.43 11.45c-.173.815-.662.982-1.315.603l-3.955-2.903-1.918 1.84c-.21.203-.38.36-.75.36l.2-.953 1.89-6.02L7.87 9.155c-.75-.68-.16-1.04.57-.79l10.37 4.025c.67.27.18.5-.14.63z"/>
                                        </svg>
                                    </a>
                                </div>
                                <p className="text-green-100 text-sm italic mt-6">
                                    Disclaimer: All blockchain interactions, token values, and image storage are simulated in this demo.
                                </p>
                            </div>
                        );
                    default:
                        return null;
                }
            };

            return (
                <>
                    {/* Notifications Display */}
                    <div id="notifications-container">
                        {notifications.map(notification => (
                            <div 
                                key={notification.id} 
                                className={`notification ${notification.type}`}
                            >
                                {notification.message}
                            </div>
                        ))}
                    </div>

                    {/* "You've been Mooch'd!" animation overlay (for voting) */}
                    {showMoochedAnimation && (
                        <div id="mooched-animation-container">
                            <h2 className="mooched-message">YOU'VE BEEN MOOCH'D!</h2>
                        </div>
                    )}

                    {/* "You have Mooch'd a meme" animation overlay (for submission) */}
                    {showMoochdMemeAnimation && (
                        <div id="moochd-meme-animation-container">
                            <h2 className="moochd-meme-message">YOU HAVE MOOCH'D A MEME!</h2>
                        </div>
                    )}

                    {/* Wallet Settings Modal (conditionally rendered) */}
                    {showWalletModal && (
                        <WalletSettingsModal 
                            account={account} 
                            chainId={chainId} 
                            onDisconnect={disconnectWallet} 
                            onClose={() => setShowWalletModal(false)} 
                            MOOCH_PRICE_USD={MOOCH_PRICE_USD} /* Pass prices to modal */
                            AVAX_PRICE_USD={AVAX_PRICE_USD}
                            mockTokenBalance={mockTokenBalance}
                            mockAvaxBalance={mockAvaxBalance}
                        />
                    )}

                    {/* The entire application UI is rendered here */}
                    <header>
                        <div className="header-logo-title-wrap">
                            <img src="https://imgur.com/roCgcDm.png" alt="Mooch Runner Logo" />
                            <h1>MOOCH RUNNER</h1>
                            <p class="header-tagline">Vote • Submit • Earn $MOOCH</p>
                        </div>
                        {/* Header Timer & Phase Display */}
                        <div class="header-timer-info">
                            <p>Phase: <span className="text-green-300">{currentCycleStatus}</span></p>
                            <div className="timer-box">
                                <div className="clock">
                                    <FlipDisplay value={String(hours).padStart(2, '0')} />
                                    <span className="text-0f0 text-lg font-orbitron">:</span>
                                    <FlipDisplay value={String(minutes).padStart(2, '0')} />
                                    <span className="text-0f0 text-lg font-orbitron">:</span>
                                    <FlipDisplay value={String(seconds).padStart(2, '0')} />
                                </div>
                            </div>
                        </div>
                        {/* User Profile Icon */}
                        <div class="profile-icon" onClick={() => setShowWalletModal(true)}>M</div>
                    </header>

                    <div id="live-vote-track-container">
                        <div className="live-vote-track-inner">
                            {liveVoteNotifications.map(notification => (
                                <div key={notification.id} className="live-vote-slide">
                                    {notification.message}
                                </div>
                            ))}
                        </div>
                    </div>

                    <nav>
                        {['HOME', 'VOTE', 'SUBMIT MEME', 'WALLET', 'TRENDING', 'ABOUT'].map(label => (
                            <button
                                key={label}
                                onClick={() => setActiveTab(label.toLowerCase())}
                                className={`font-bold py-3 px-6 rounded-full transition-all duration-300 ${activeTab.toUpperCase() === label ? 'active-nav' : ''}`}
                            >
                                {label}
                            </button>
                        ))}
                    </nav>

                    <main>
                        {!account ? (
                            <div className="app-section w-full max-w-md text-center mx-auto">
                                <h2 className="mb-6">CONNECT WALLET</h2>
                                <p className="text-green-100 mb-6">Connect your wallet to participate in the Mooch Runner DApp.</p>
                                <button
                                    onClick={connectWallet}
                                    className="vote-btn w-full"
                                    disabled={isLoading}
                                >
                                    {isLoading ? "Connecting..." : "Connect Wallet (Mock)"}
                                </button>
                                {message && <p className="mt-4 text-sm text-green-300">{message}</p>}
                            </div>
                        ) : (
                            <div className="w-full max-w-full">
                                {renderContent()}
                            </div>
                        )}
                    </main>

                    <footer>
                        &copy; 2025 Mooch Runner | Built for Degens by Degens 🧠
                    </footer>
                </>
            );
        };

        // Initial render of the App component into the #root div
        ReactDOM.render(<App />, document.getElementById('root-container'));
    </script>
</body>
</html>
